<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Demonstrates using an R package inside a Docker image.">
<title>R package Docker Demo • rpdd</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="R package Docker Demo">
<meta property="og:description" content="Demonstrates using an R package inside a Docker image.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rpdd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rpdd">rpdd<a class="anchor" aria-label="anchor" href="#rpdd"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of rpdd is to demonstrate how to build an R package, build a Docker image that contains the built package, and how to run a pipeline inside the container using package functions.</p>
<div class="section level2">
<h2 id="r-package">R package<a class="anchor" aria-label="anchor" href="#r-package"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>You can install the rpdd R package from <a href="https://github.com/stephenturner/rpdd" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"stephenturner/rpdd"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>The rpdd package has a single function: <code><a href="reference/missyelliot.html">missyelliot()</a></code>. This function reverse complements a DNA sequence (take it, flip it, and reverse it). Its input is a character vector and it returns a named vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stephenturner.github.io/rpdd/">rpdd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/missyelliot.html">missyelliot</a></span><span class="op">(</span><span class="st">"GATTACA"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   GATTACA </span></span>
<span><span class="co">#&gt; "TGTAATC"</span></span></code></pre></div>
<p>The <code><a href="reference/missyelliot.html">missyelliot()</a></code> function can also be used inside a pipeline. Here demonstrating using base R, but this could be used with tibble and dplyr as well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>original_sequence<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GATTACA"</span>, <span class="st">"GATACAT"</span>, <span class="st">"ATTAC"</span>, <span class="st">"GAGA"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>revcomp<span class="op">=</span><span class="fu"><a href="reference/missyelliot.html">missyelliot</a></span><span class="op">(</span><span class="va">original_sequence</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         original_sequence revcomp</span></span>
<span><span class="co">#&gt; GATTACA           GATTACA TGTAATC</span></span>
<span><span class="co">#&gt; GATACAT           GATACAT ATGTATC</span></span>
<span><span class="co">#&gt; ATTAC               ATTAC   GTAAT</span></span>
<span><span class="co">#&gt; GAGA                 GAGA    TCTC</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="docker-container">Docker container<a class="anchor" aria-label="anchor" href="#docker-container"></a>
</h2>
<p>The Docker container does more than the R package. The container itself runs a short pipeline. It first runs a shell script (<a href="docker/src/rpdd.sh">docker/src/rpdd.sh</a>) which takes two arguments: a FASTA file and a BED file. The container will use <a href="https://github.com/lh3/seqtk" class="external-link">seqtk</a> to pull out sequence in the FASTA file corresponding to the intervals in the BED file, and writes that to <code>&lt;inputfastafilename&gt;.regions.txt</code>. The container then runs an R script (<a href="docker/src/rpdd.R">docker/src/rpdd.R</a>) to read in that data, and reverse complements those sequences, writing them out to <code>&lt;inputfastafilename&gt;.revcomp.txt</code>.</p>
<p>After going through the documentation below, study the following files in order to get a sense of what’s going on:</p>
<ol style="list-style-type: decimal">
<li><a href="docker/Dockerfile">docker/Dockerfile</a></li>
<li><a href="docker/src/rpdd.sh">docker/src/rpdd.sh</a></li>
<li><a href="docker/src/rpdd.R">docker/src/rpdd.R</a></li>
</ol>
<div class="section level3">
<h3 id="build">Build<a class="anchor" aria-label="anchor" href="#build"></a>
</h3>
<p>Use the <a href="build.sh">build.sh</a> script. This builds the R package, copies the build package into <a href="docker/src">docker/src</a>, then builds the docker image with appropriate tags.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./build.sh</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>The container starts running at <code>/data/</code> inside the container, so you must first mount a directory on the host to the <code>/data/</code> directory in the container. Alternatively, you can navigate to where your data files live, and mount the current working directory to the same path on the host, and set that as the working directory. Examples are shown below.</p>
<p>Example testing data files are located in <a href="inst/extdata">inst/extdata</a> in this repo. Here’s the <a href="inst/extdata/seq.fasta">inst/extdata/seq.fasta</a> file:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>TGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATC</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>TGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATC</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>TGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATC</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>TGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATC</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>TGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATCTGTAATC</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="dv">2</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>ATGTATCATGTATCATGTATCATGTATCATGTATCATGTATCATGTATC</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ATGTATCATGTATCATGTATCATGTATCATGTATCATGTATCATGTATC</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>ATGTATCATGTATCATGTATCATGTATCATGTATCATGTATCATGTATC</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>ATGTATCATGTATCATGTATCATGTATCATGTATCATGTATCATGTATC</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>ATGTATCATGTATCATGTATCATGTATCATGTATCATGTATCATGTATC</span></code></pre></div>
<p>Here’s the <a href="inst/extdata/reg.bed">inst/extdata/reg.bed</a> file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">7</span> <span class="dv">14</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">28</span> <span class="dv">35</span></span></code></pre></div>
<p>The container will use seqtk to pull out contig 1 positions 7-14, and contig 2 positions 28-35, and it will reverse complement them, writing output alongside the input files.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-v</span> /full/host/path/to/inst/extdata:/data rpdd seq.fasta reg.bed</span></code></pre></div>
<p>What are these flags?</p>
<ul>
<li>
<code>--rm</code>: By default, when a Docker container is run without this flag, the Docker container is created, the container runs, and then exits, but is not deleted. In other words, Docker containers are NOT ephemeral by default. A local copy of the container is kept and takes up unnecessary storage space. It is a good idea to always use this flag so that the container is removed after running it, unless for some reason you need the container after the specified program has been run.</li>
<li>
<code>-v /full/host/path/to/inst/extdata:/data</code>: The -v flag mounts a volume between your local machine and the Docker container. This specific command mounts <code>/full/host/path/to/inst/extdata</code> the <code>/data</code> directory within the Docker container, which makes the files on your local machine accessible to the container, which starts in <code>/data</code> by default.</li>
</ul>
<p>Here’s what you’ll see:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Input fasta<span class="sc">:</span>   seq.fasta</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Input regions<span class="sc">:</span> reg.bed</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Writing sequence <span class="cf">in</span> select regions to seq.fasta.regions.txt ...</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>Writing reverse complemented region sequences to seq.fasta.revcomp.txt ...</span></code></pre></div>
<p>Let’s take a look at the output file <a href="inst/extdata/seq.fasta.regions.txt">inst/extdata/seq.fasta.regions.txt</a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>TGTAATC</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ATGTATC</span></code></pre></div>
<p>These are the regions we extracted above. Let’s take a look at the output file <a href="inst/extdata/seq.fasta.revcomp.txt">inst/extdata/seq.fasta.revcomp.txt</a>, which has the reverse complemented sequences we extracted (“Gattaca!”, “Get A Cat!”):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>GATTACA</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>GATACAT</span></code></pre></div>
<p>Running Docker in this way on a Linux system will create files owned by root that you cannot remove. Further, you might want to run this on files in the directory you’re in. Here’s how to do that.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Go somewhere where you have the data located. E.g.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cd inst/extdata</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:<span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="at">-w</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> <span class="at">-u</span> <span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span>:<span class="va">$(</span><span class="fu">id</span> <span class="at">-g</span><span class="va">)</span> rpdd seq.fasta reg.bed</span></code></pre></div>
<p>What’s the rest of this doing?</p>
<ul>
<li>
<code>$(pwd):$(pwd)</code>: This mounts your present working directory (e.g., <code>/home/yourname/wherever/</code>) to a directory <em>inside the container</em> with the same name.</li>
<li>
<code>-w $(pwd)</code>: This sets the working directory <em>inside the container</em> to the same directory. Now, the files that you have on disk on the host will be available in the container. This is what you might be accusomed to if you use Singularity.</li>
<li>
<code>-u $(id -u):$(id -g)</code>: By default, when Docker containers are run, they are run as the root user. This can be problematic because any files created from within the container will have root permissions/ownership and the local user will not be able to do much with them. The -u flag sets the container’s user and group based on the user and group from the local machine, resulting in the correct file ownership.</li>
</ul>
<p>Optional, you can create a function in your <code>~/.bashrc</code> that looks like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> docker_run  { docker run <span class="sc">--</span>rm <span class="sc">-</span>v <span class="sc">$</span>(pwd)<span class="sc">:</span><span class="er">$</span>(pwd) <span class="sc">-</span>w <span class="sc">$</span>(pwd) <span class="sc">-</span>u <span class="sc">$</span>(id <span class="sc">-</span>u)<span class="sc">:</span><span class="er">$</span>(id <span class="sc">-</span>g) <span class="st">"$@"</span>; }</span></code></pre></div>
<p>This allows you to use <code>docker_run &lt;image&gt; &lt;args&gt;</code> instead of <code>docker run --rm -v $(pwd):$(pwd) -w $(pwd) -u $(id -u):$(id -g) &lt;image&gt; &lt;args&gt;</code>.</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h1>
<p>The StaPH-B Docker User Guide is a great place to start. Read all the chapters (drop-down in the upper right). Some of the documentation on command line flags to <code>docker run</code> came from this guide. Go read: <strong><a href="https://staphb.org/docker-builds/" class="external-link uri">https://staphb.org/docker-builds/</a></strong>.</p>
<p>The Nust et al 2020 <em>PLoS Comp Bio</em> article, “Ten simple rules for writing Dockerfiles for reproducible data science” is also a great resource: <strong><a href="https://doi.org/10.1371/journal.pcbi.1008316" class="external-link uri">https://doi.org/10.1371/journal.pcbi.1008316</a></strong>.</p>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rpdd</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>VP Nagraj <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-0060-566X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Stephen Turner <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9140-9028" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/stephenturner/rpdd/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/stephenturner/rpdd/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by VP Nagraj, Stephen Turner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
